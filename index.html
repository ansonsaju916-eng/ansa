<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SSLC Biology: Immunity Master Lab</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #F8FAFC; 
            color: #334155;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* Smooth Transitions */
        .transition-all-300 { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Card Styling */
        .pro-card {
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            overflow: hidden;
        }

        /* Detail Box Styling */
        .detail-box {
            background-color: #F8FAFC;
            border-left: 4px solid #6366F1;
            padding: 12px 16px;
            margin-top: 16px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .detail-title {
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 10px; }

        /* Animation Keyframes */
        @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .animate-pulse-soft { animation: pulse-soft 2s infinite; }
        
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slide-up 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 1s ease-out forwards; }
        
        @keyframes float-btn { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-float-btn { animation: float-btn 3s ease-in-out infinite; }

        /* Premium Background Animation */
        @keyframes gradient-xy {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animate-gradient-xy {
            background-size: 200% 200%;
            animation: gradient-xy 15s ease infinite;
        }

        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob { animation: blob 7s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        /* Markdown-like simple styling */
        .ai-text strong { color: #4338ca; font-weight: 700; }
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const apiKey = "AIzaSyAHY9Fk6IgqbYLGshgAmaaZRf4QGTPk9SU"; 

        // --- ICON DEFINITIONS ---
        // Using inline SVGs for stability without external dependencies
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Shield = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></IconBase>;
        const Droplets = (props) => <IconBase {...props}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z" /><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35" /></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></IconBase>;
        const Skull = (props) => <IconBase {...props}><circle cx="9" cy="12" r="1" /><circle cx="15" cy="12" r="1" /><path d="M8 20v2h8v-2" /><path d="m12.5 17-.5-1-.5 1h1z" /><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20" /></IconBase>;
        const Microscope = (props) => <IconBase {...props}><path d="M6 18h8" /><path d="M3 22h18" /><path d="M14 22a7 7 0 1 0 0-14h-1" /><path d="M9 14h2" /><path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z" /><path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3" /></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>;
        const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12" /></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /></IconBase>;
        const Leaf = (props) => <IconBase {...props}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z" /><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12" /></IconBase>;
        const Menu = (props) => <IconBase {...props}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><path d="m9 18 6-6-6-6" /></IconBase>;
        const ChevronDown = (props) => <IconBase {...props}><path d="m6 9 6 6 6-6" /></IconBase>;
        const Thermometer = (props) => <IconBase {...props}><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z" /></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M19 14c1.49-1.28 3.6-2.33 3.6-4.7 0-2.37-1.91-4.3-4.3-4.3-1.68 0-3.12 1.02-3.8 2.58l-.5.96-.5-.96C12.92 6.02 11.48 5 9.8 5 7.41 5 5.5 6.93 5.5 9.3c0 2.37 2.11 3.42 3.6 4.7l6.4 5.2z" /></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /></IconBase>;
        const Brain = (props) => <IconBase {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z" /><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" /></IconBase>;
        const Flame = (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3a1 1 0 0 1 1.4-.2z"/></IconBase>;
        const Wand = (props) => <IconBase {...props}><path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8 19 13"/><path d="M15 9h0"/><path d="M17.8 6.2 19 5"/><path d="m3 21 9-9"/><path d="M12.2 6.2 11 5"/></IconBase>;
        const Swords = (props) => <IconBase {...props}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5" /><line x1="13" x2="19" y1="19" y2="13" /><line x1="16" x2="20" y1="16" y2="20" /><line x1="19" x2="21" y1="21" y2="19" /><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5" /><line x1="5" x2="9" y1="14" y2="18" /><line x1="7" x2="4" y1="17" y2="20" /><line x1="3" x2="5" y1="19" y2="21" /></IconBase>;
        const Lightbulb = (props) => <IconBase {...props}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></IconBase>;
        const ArrowLeft = (props) => <IconBase {...props}><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></IconBase>;
        const Send = (props) => <IconBase {...props}><path d="m22 2-7 20-4-9-9-4Z" /><path d="M22 2 11 13" /></IconBase>;
        const Check = (props) => <IconBase {...props}><path d="M20 6 9 17l-5-5" /></IconBase>;
        // Added missing icons
        const Layers = (props) => <IconBase {...props}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z" /><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65" /><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65" /></IconBase>;
        const MessageSquare = (props) => <IconBase {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" /></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></IconBase>;

        // --- GEMINI API HELPERS ---
        const callGemini = async (prompt, systemInstruction = "") => {
            if (!apiKey) return "‚ö†Ô∏è API Key missing. Simulation mode active.";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: systemInstruction }] } })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "No data received.";
            } catch (error) { return "Connection error."; }
        };

        const callGeminiJSON = async (prompt, schema) => {
             if (!apiKey) return null;
             try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json", responseSchema: schema }
                    })
                });
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            } catch (error) { return null; }
        };

        // --- UI COMPONENTS ---
        const ModernBtn = ({ onClick, label, variant = "primary", disabled = false, icon: Icon, className = "" }) => {
            const variants = {
                primary: "bg-slate-900 text-white active:bg-slate-950 shadow-lg shadow-slate-900/20 hover:-translate-y-0.5",
                secondary: "bg-white text-slate-700 border border-slate-200 active:bg-slate-50 hover:border-slate-300",
                accent: "bg-teal-600 text-white active:bg-teal-700 shadow-lg shadow-teal-600/20 hover:-translate-y-0.5",
                danger: "bg-rose-600 text-white active:bg-rose-700 shadow-lg shadow-rose-600/20 hover:-translate-y-0.5",
                indigo: "bg-indigo-600 text-white active:bg-indigo-700 shadow-lg shadow-indigo-600/20 hover:-translate-y-0.5",
                amber: "bg-amber-500 text-white hover:bg-amber-600 shadow-lg shadow-amber-500/20",
                ghost: "bg-transparent text-slate-500 active:text-slate-900 hover:bg-slate-100"
            };
            return (
                <button 
                    onClick={onClick} 
                    disabled={disabled} 
                    className={`flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-medium text-sm transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${variants[variant]} ${className}`}
                >
                    {Icon && <Icon size={18} />}
                    {label}
                </button>
            );
        };

        const Badge = ({ children, color = "slate" }) => {
            const colors = {
                slate: "bg-slate-100 text-slate-700",
                teal: "bg-teal-50 text-teal-700 border border-teal-100",
                rose: "bg-rose-50 text-rose-700 border border-rose-100",
                indigo: "bg-indigo-50 text-indigo-700 border border-indigo-100",
                amber: "bg-amber-50 text-amber-700 border border-amber-100"
            };
            return <span className={`px-2.5 py-0.5 rounded-full text-xs font-semibold ${colors[color]}`}>{children}</span>;
        };

        const DetailBox = ({ title, children, isOpen, toggle }) => (
            <div className="mt-4">
                <button onClick={toggle} className="w-full flex justify-between items-center text-xs font-bold text-indigo-600 hover:text-indigo-800 transition-colors uppercase tracking-wide mb-2 py-2">
                    {isOpen ? "Hide Textbook Details" : "Show Textbook Details"}
                    {isOpen ? <X size={14}/> : <ChevronDown size={14}/>}
                </button>
                {isOpen && (
                    <div className="detail-box animate-slide-up">
                        <div className="detail-title"><BookOpen size={16}/> {title}</div>
                        {children}
                    </div>
                )}
            </div>
        );

        // --- LANDING PAGE ---
        const LandingPage = ({ onEnter }) => {
            return (
                <div className="relative min-h-screen w-full overflow-hidden flex flex-col items-center justify-center font-['Inter']">
                    <div className="absolute inset-0 bg-gradient-to-br from-indigo-50 via-white to-purple-50 animate-gradient-xy"></div>
                    <div className="absolute top-0 -left-4 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
                    <div className="absolute top-0 -right-4 w-72 h-72 bg-indigo-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
                    <div className="absolute -bottom-8 left-20 w-72 h-72 bg-teal-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>

                    <div className="relative z-10 w-full max-w-lg px-6 flex flex-col items-center justify-center text-center pb-20 pt-10 min-h-screen">
                        <div className="mb-12 animate-slide-up opacity-0" style={{animationDelay: '0.1s'}}>
                            <h1 className="text-6xl md:text-7xl font-['Playfair_Display'] text-slate-900 tracking-tight leading-none mb-2">WELCOME</h1>
                            <h1 className="text-6xl md:text-7xl font-['Playfair_Display'] italic text-indigo-900 tracking-tight leading-none">ANSA</h1>
                        </div>
                        <div className="w-full glass-panel rounded-2xl p-8 mb-16 shadow-xl animate-slide-up opacity-0" style={{animationDelay: '0.3s'}}>
                            <div className="flex justify-center mb-4 text-indigo-400"><Sparkles size={24} /></div>
                            <p className="text-lg md:text-xl text-slate-700 leading-relaxed font-light mb-6">"I just want you to study well and write your exams confidently, Ansa... I know you can do it."</p>
                            <div className="flex justify-center gap-3 text-2xl"><span>üíõ</span><span>‚ú®</span></div>
                        </div>
                        <div className="animate-slide-up opacity-0 w-full" style={{animationDelay: '0.5s'}}>
                            <button onClick={onEnter} className="group relative w-full bg-slate-900 text-white rounded-2xl py-5 px-8 text-lg font-bold shadow-2xl shadow-slate-900/30 hover:shadow-slate-900/50 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 overflow-hidden flex items-center justify-center gap-3">
                                <span className="relative z-10">Get Started</span>
                                <ChevronRight className="w-5 h-5 relative z-10 group-hover:translate-x-1 transition-transform" />
                                <div className="absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12"></div>
                            </button>
                            <p className="mt-4 text-xs text-slate-400 font-medium tracking-wide uppercase">SSLC Biology Master Lab</p>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ZONE 1: EXTERNAL DEFENSE ---
        const ZoneExternal = () => {
            const [layer, setLayer] = useState(0); 
            const [showDetails, setShowDetails] = useState(false);
            
            return (
                <div className="space-y-6 animate-slide-up">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="pro-card p-6 relative">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                                    <Shield size={20} className="text-teal-600"/> Skin Barrier
                                </h3>
                                <Badge color="teal">First Line</Badge>
                            </div>
                            <div className="relative h-48 rounded-xl overflow-hidden border border-slate-200 bg-orange-50 mb-4">
                                <div className="absolute bottom-0 w-full h-1/2 bg-orange-200 border-t border-orange-300 flex items-center justify-center text-xs font-bold text-orange-800 opacity-50">DERMIS</div>
                                <div className="absolute bottom-1/2 w-full h-12 bg-orange-300 border-t-4 border-orange-400 flex items-center justify-center text-xs font-bold text-orange-900 z-10">EPIDERMIS</div>
                                <div className="absolute inset-0 z-20 pointer-events-none">
                                    {layer === 1 && <div className="absolute top-4 left-1/2 -translate-x-1/2 text-center"><div className="text-xs font-bold text-slate-500 mb-1">Pathogen Blocked</div><div className="text-2xl animate-bounce">üõ°Ô∏è</div></div>}
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <ModernBtn label="Test Keratin" variant="secondary" onClick={() => setLayer(1)} />
                                <ModernBtn label="Test Sweat" variant="secondary" onClick={() => setLayer(2)} />
                            </div>
                        </div>
                        <div className="pro-card p-6">
                            <h3 className="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2"><Droplets size={20} className="text-indigo-600"/> Chemical Defense</h3>
                            <ul className="space-y-3">
                                <li className="flex items-start gap-3 p-3 rounded-lg bg-slate-50 border border-slate-100">
                                    <div className="bg-white p-1.5 rounded shadow-sm text-indigo-600"><Zap size={16}/></div>
                                    <div><div className="text-sm font-bold text-slate-800">Lysozyme</div><div className="text-xs text-slate-500">Tears & Saliva ‚Ä¢ Breaks cell walls</div></div>
                                </li>
                                <li className="flex items-start gap-3 p-3 rounded-lg bg-slate-50 border border-slate-100">
                                    <div className="bg-white p-1.5 rounded shadow-sm text-green-600"><Skull size={16}/></div>
                                    <div><div className="text-sm font-bold text-slate-800">Hydrochloric Acid</div><div className="text-xs text-slate-500">Stomach ‚Ä¢ Destroys food germs</div></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div className="pro-card p-4">
                        <DetailBox title="Detailed Study Notes: First Line of Defense" isOpen={showDetails} toggle={() => setShowDetails(!showDetails)}>
                            <ul className="list-disc pl-5 space-y-2 text-slate-700">
                                <li><strong>Skin (Epidermis):</strong> The outermost layer contains a tough, fibrous protein called <strong>Keratin</strong>. It acts as a waterproof physical barrier that prevents the entry of germs.</li>
                                <li><strong>Sebum:</strong> An oily secretion from sebaceous glands. It keeps the skin waterproof and maintains a slightly acidic pH that discourages bacterial growth.</li>
                                <li><strong>Sweat:</strong> Contains salts and disinfectants that wash away pathogens and inhibit their growth.</li>
                                <li><strong>Commensal Bacteria:</strong> These are helpful bacteria living on our skin. They compete with harmful pathogens for space and nutrients, effectively starving the bad germs.</li>
                                <li><strong>Mucous Membranes:</strong> Line the respiratory, digestive, and urinary tracts. <strong>Mucus</strong> traps dust and germs, while <strong>Cilia</strong> (hair-like structures) sweep the mucus out (cough reflex).</li>
                            </ul>
                        </DetailBox>
                    </div>
                </div>
            );
        };

        // --- ZONE 2: INTERNAL DEFENSE ---
        const InflammationSimulator = () => {
            const [injury, setInjury] = useState("");
            const [response, setResponse] = useState(null);
            const [loading, setLoading] = useState(false);
            const [isNewsMode, setIsNewsMode] = useState(false);

            const simulate = async () => {
                if (!injury) return;
                setLoading(true);
                let prompt = "";
                if (isNewsMode) {
                    prompt = `Write a dramatic, "Breaking News" TV script reporting on an injury: "${injury}". You are an anchor named "Immuno-Ron". Describe the scene (swelling, heat) and the arrival of "First Responder Phagocytes" and "Chemical Squads (Histamine)". Keep it funny and educational for students. Max 100 words.`;
                } else {
                    prompt = `Describe the body's inflammatory response to: "${injury}". Explain the role of Histamine, vasodilation, and phagocytes simply for a 10th grader. Keep it short.`;
                }
                const res = await callGemini(prompt);
                setResponse(res);
                setLoading(false);
            };

            return (
                <div className="pro-card p-6 mt-6 bg-slate-50 border-2 border-indigo-100 animate-slide-up">
                    <h3 className="font-bold text-lg text-indigo-900 mb-4 flex items-center gap-2">
                        <Flame size={20} className="text-orange-500"/> ‚ú® AI Inflammation Storyteller
                    </h3>
                    <div className="flex flex-col gap-3 mb-4">
                        <div className="flex items-center gap-2 mb-2">
                             <label className="flex items-center gap-2 cursor-pointer select-none text-sm text-slate-600 bg-white px-3 py-1 rounded-full border border-slate-200 shadow-sm">
                                <input type="checkbox" checked={isNewsMode} onChange={e => setIsNewsMode(e.target.checked)} className="rounded text-indigo-600 focus:ring-indigo-500" />
                                üì∫ News Anchor Mode
                            </label>
                        </div>
                        <div className="flex gap-2">
                            <input 
                                value={injury} 
                                onChange={(e) => setInjury(e.target.value)} 
                                placeholder="Enter injury (e.g. Bee Sting, Cut)..." 
                                className="flex-1 px-4 py-3 rounded-xl border border-slate-300 text-sm focus:outline-none focus:border-indigo-500 shadow-sm"
                            />
                            <ModernBtn label={isNewsMode ? "Broadcast ‚ú®" : "Simulate ‚ú®"} onClick={simulate} variant="primary" disabled={loading} />
                        </div>
                    </div>
                    {response && (
                        <div className="bg-white p-4 rounded-xl border border-indigo-100 text-sm text-slate-700 leading-relaxed animate-slide-up shadow-sm">
                            <strong className="text-indigo-700 block mb-2">{isNewsMode ? "üì∫ LIVE BROADCAST:" : "Biological Response Log:"}</strong>
                            <div className="ai-text" dangerouslySetInnerHTML={{__html: response.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br/>')}}></div>
                        </div>
                    )}
                </div>
            );
        };

        const PhagocytosisLab = () => {
            const [step, setStep] = useState(0);
            const [showDetails, setShowDetails] = useState(false);

            return (
                <div className="pro-card p-6 animate-slide-up">
                    <div className="flex justify-between items-start mb-6">
                        <div><h3 className="font-bold text-lg text-slate-800">Phagocytosis Simulation</h3><p className="text-sm text-slate-500">Neutrophils & Monocytes in action</p></div>
                        <Badge color="indigo">Second Line</Badge>
                    </div>
                    <div className="relative h-64 bg-slate-900 rounded-xl overflow-hidden mb-6 flex items-center justify-center border border-slate-800">
                        <div className="absolute inset-0 opacity-10" style={{backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '20px 20px'}}></div>
                        <div className={`w-32 h-32 bg-indigo-500/80 backdrop-blur-md flex items-center justify-center transition-all duration-700 absolute ${step === 0 ? 'rounded-full scale-100' : ''} ${step === 1 ? 'rounded-[40%_60%_70%_30%/40%_50%_60%_50%] scale-110 translate-x-4' : ''} ${step === 2 ? 'rounded-full scale-105' : ''}`}>
                            <div className="text-white text-xs font-bold opacity-50">NUCLEUS</div>
                            {step >= 2 && <div className="absolute w-6 h-6 bg-yellow-400 rounded-full top-4 right-4 shadow-lg shadow-yellow-400/50 animate-pulse"></div>}
                        </div>
                        <div className={`absolute transition-all duration-700 ${step === 0 ? 'right-20 text-4xl animate-bounce' : ''} ${step === 1 ? 'right-1/2 translate-x-4 text-2xl opacity-80' : ''} ${step === 2 ? 'right-1/2 text-xl opacity-0 scale-0' : ''}`}>ü¶†</div>
                        <div className="absolute bottom-4 left-4 text-xs font-mono text-indigo-300">STATUS: {step === 0 ? "DETECTING..." : step === 1 ? "ENGULFING (PHAGOSOME)..." : "DIGESTING..."}</div>
                    </div>
                    <div className="flex flex-col sm:flex-row justify-between items-center bg-slate-50 p-4 rounded-lg border border-slate-100 gap-4">
                        <div className="text-sm font-medium text-slate-700">{step === 0 && "1. Phagocyte detects pathogen."}{step === 1 && "2. Pseudopodia extend to engulf germ."}{step === 2 && "3. Lysosomes fuse & digest germ."}</div>
                        <ModernBtn label={step < 2 ? "Next Step" : "Reset"} onClick={() => setStep(s => s < 2 ? s + 1 : 0)} variant="primary" icon={ChevronRight} className="w-full sm:w-auto" />
                    </div>
                    
                    <InflammationSimulator />

                    <DetailBox title="Mechanism: Internal Nonspecific Defense" isOpen={showDetails} toggle={() => setShowDetails(!showDetails)}>
                        <div className="space-y-4 text-slate-700">
                            <div>
                                <strong className="text-indigo-700">1. Phagocytosis Steps:</strong>
                                <ol className="list-decimal pl-5 mt-1 space-y-1">
                                    <li>Phagocyte approaches the germ.</li>
                                    <li>Engulfs pathogen in a membrane sac called the <strong>Phagosome</strong>.</li>
                                    <li><strong>Lysosome</strong> fuses with the phagosome.</li>
                                    <li>Enzymes digest and destroy the pathogen.</li>
                                    <li>Waste is expelled.</li>
                                </ol>
                            </div>
                            <div>
                                <strong className="text-indigo-700">2. Inflammatory Response:</strong>
                                <p>When tissues are damaged, chemicals like <strong>Histamine</strong> are released. This causes <strong>vasodilation</strong> (widening of blood vessels), leading to increased blood flow. This results in redness, heat, and swelling, but allows more White Blood Cells to reach the site quickly.</p>
                            </div>
                        </div>
                    </DetailBox>
                </div>
            );
        };

        const FeverChart = () => {
            const [temp, setTemp] = useState(37);
            const [showDetails, setShowDetails] = useState(false);
            const infectionLoad = temp < 38 ? 100 : Math.max(0, 100 - (temp - 37) * 40);
            
            return (
                <div className="pro-card p-6 mt-6 animate-slide-up">
                    <h3 className="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2"><Thermometer size={20} className="text-rose-500"/> Fever Response</h3>
                    <div className="flex flex-col sm:flex-row gap-8 items-center">
                        <div className="flex-1 w-full">
                            <div className="flex justify-between text-xs font-bold text-slate-500 mb-2"><span>BODY TEMP</span><span className={temp > 37.5 ? "text-rose-600" : "text-emerald-600"}>{temp}¬∞C</span></div>
                            <input type="range" min="37" max="41" step="0.1" value={temp} onChange={(e) => setTemp(parseFloat(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-rose-500" />
                        </div>
                        <div className="flex-1 w-full bg-slate-900 rounded-lg p-4">
                            <div className="text-xs font-mono text-slate-400 mb-2">GERM REPLICATION RATE</div>
                            <div className="w-full bg-slate-700 rounded-full h-2 overflow-hidden"><div className={`h-full transition-all duration-500 ${infectionLoad > 50 ? "bg-rose-500" : "bg-emerald-500"}`} style={{width: `${infectionLoad}%`}}></div></div>
                        </div>
                    </div>
                    
                    <DetailBox title="Physiology: Fever" isOpen={showDetails} toggle={() => setShowDetails(!showDetails)}>
                        <p className="text-slate-700">
                            Fever is not a disease but a defense mechanism. White Blood Cells produce chemicals called <strong>Pyrogens</strong> that raise the body's temperature. High temperature inhibits the multiplication of germs and increases the production of <strong>Interferon</strong> (a protein that blocks viral replication).
                        </p>
                    </DetailBox>
                </div>
            )
        }

        // --- NEW COMPONENT: ANALOGY GENERATOR ---
        const AnalogyGenerator = () => {
            const [concept, setConcept] = useState("");
            const [analogy, setAnalogy] = useState("");
            const [loading, setLoading] = useState(false);

            const generateAnalogy = async () => {
                if (!concept) return;
                setLoading(true);
                const prompt = `Explain the biological concept "${concept}" using a simple, creative real-world analogy (like football, a castle siege, or a kitchen). Keep it short and fun for a student.`;
                const res = await callGemini(prompt);
                setAnalogy(res);
                setLoading(false);
            }

            return (
                <div className="bg-indigo-50 border border-indigo-100 rounded-xl p-6 mt-6">
                    <h3 className="font-bold text-lg text-indigo-900 mb-2 flex items-center gap-2">
                        <Lightbulb size={20} className="text-yellow-500"/> ‚ú® Smart Analogy Generator
                    </h3>
                    <p className="text-xs text-indigo-600 mb-4">Confused? Ask AI to explain a concept using a simple comparison.</p>
                    <div className="flex gap-2 mb-4">
                         <input 
                            value={concept} 
                            onChange={(e) => setConcept(e.target.value)} 
                            placeholder="e.g. Antibody, Vaccine, T-Cell..." 
                            className="flex-1 px-4 py-3 rounded-xl border border-indigo-200 text-sm focus:outline-none focus:border-indigo-500 bg-white"
                        />
                        <ModernBtn label="Explain ‚ú®" onClick={generateAnalogy} variant="indigo" disabled={loading} />
                    </div>
                    {analogy && (
                        <div className="bg-white p-4 rounded-xl border border-indigo-200 text-sm text-slate-700 shadow-sm leading-relaxed animate-slide-up">
                            <strong className="text-indigo-600 block mb-1">Analogy:</strong>
                            {analogy}
                        </div>
                    )}
                </div>
            );
        };

        // --- ZONE 3: SPECIFIC DEFENSE ---
        const SpecificDefense = () => {
            const [chatOpen, setChatOpen] = useState(null);
            const [chatHistory, setChatHistory] = useState([]);
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const [showDetails, setShowDetails] = useState(false);

            const cells = [
                { id: 'b', name: 'B-Cell', desc: 'Antibody Factory', color: 'indigo' },
                { id: 't', name: 'T-Cell', desc: 'Cellular Assassin', color: 'rose' },
                { id: 'n', name: 'Neutrophil', desc: 'First Responder', color: 'teal' }
            ];

            const sendMsg = async () => {
                if(!input.trim()) return;
                const userMsg = input;
                setInput("");
                setChatHistory(prev => [...prev, { role: 'user', text: userMsg }]);
                setLoading(true);
                const prompt = `Roleplay as a ${chatOpen.name} (${chatOpen.desc}) in the immune system. Be professional but educational for a 10th grader. Keep it short. User asked: "${userMsg}"`;
                const reply = await callGemini(prompt);
                setChatHistory(prev => [...prev, { role: 'ai', text: reply }]);
                setLoading(false);
            };

            return (
                <div className="space-y-6 animate-slide-up">
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        {cells.map(c => (
                            <button key={c.id} onClick={() => { setChatOpen(c); setChatHistory([]); }} className={`p-4 rounded-xl border transition-all text-left group ${chatOpen?.id === c.id ? `bg-${c.color}-50 border-${c.color}-500 ring-1 ring-${c.color}-500` : 'bg-white border-slate-200 hover:border-slate-300 hover:shadow-sm'}`}>
                                <div className={`w-8 h-8 rounded-full bg-${c.color}-100 flex items-center justify-center text-${c.color}-700 font-bold text-xs mb-3`}>{c.name[0]}</div>
                                <div className="font-bold text-slate-800 text-sm">{c.name}</div>
                                <div className="text-xs text-slate-500">{c.desc}</div>
                            </button>
                        ))}
                    </div>
                    {chatOpen && (
                        <div className="pro-card flex flex-col h-[400px]">
                            <div className="p-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div><span className="font-bold text-sm text-slate-700">Chatting with {chatOpen.name}</span></div>
                                <button onClick={() => setChatOpen(null)} className="text-slate-400 hover:text-slate-600"><X size={16}/></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 custom-scroll bg-slate-50">
                                {chatHistory.map((msg, i) => <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[80%] p-3 rounded-2xl text-sm ${msg.role === 'user' ? 'bg-slate-800 text-white rounded-tr-none' : 'bg-white border border-slate-200 text-slate-700 rounded-tl-none shadow-sm'}`}>{msg.text}</div></div>)}
                                {loading && <div className="flex justify-start"><div className="bg-slate-200 rounded-full px-3 py-1 text-xs animate-pulse">Typing...</div></div>}
                            </div>
                            <div className="p-4 border-t border-slate-100 bg-white"><div className="flex gap-2"><input value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && sendMsg()} placeholder="Type your question..." className="flex-1 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all" /><ModernBtn label="Send" onClick={sendMsg} variant="primary" /></div></div>
                        </div>
                    )}
                    
                    <AnalogyGenerator />

                    <div className="pro-card p-4">
                        <DetailBox title="Study Notes: Specific Defense & Lymphocytes" isOpen={showDetails} toggle={() => setShowDetails(!showDetails)}>
                            <ul className="list-disc pl-5 space-y-2 text-slate-700">
                                <li><strong>B-Lymphocytes (B-Cells):</strong> Mature in the <strong>Bone Marrow</strong>. They produce antibodies that attack bacteria and viruses present in body fluids (blood/lymph).</li>
                                <li><strong>T-Lymphocytes (T-Cells):</strong> Mature in the <strong>Thymus gland</strong>. They attack the body's own cells that have been infected (by viruses or cancer). They also stimulate B-cells to produce antibodies.</li>
                                <li><strong>Antigens:</strong> Any foreign substance (like a germ surface protein) that triggers an immune response.</li>
                                <li><strong>Antibodies:</strong> Y-shaped proteins produced by B-cells that lock onto specific antigens to destroy them (Disintegrate, Neutralize, or Clump).</li>
                            </ul>
                        </DetailBox>
                    </div>
                </div>
            );
        };

        // --- ZONE 4: BLOOD & VACCINES ---
        const BloodLab = () => {
            const [donor, setDonor] = useState('A');
            const [recipient, setRecipient] = useState('B');
            const [result, setResult] = useState(null);
            const [report, setReport] = useState(null);
            const [generating, setGenerating] = useState(false);
            const [showDetails, setShowDetails] = useState(false);

            const check = () => {
                let safe = false;
                if (donor === 'O' || recipient === 'AB' || donor === recipient) safe = true;
                setResult(safe ? 'safe' : 'clot');
                setReport(null);
            };

            const generateReport = async () => {
                setGenerating(true);
                const status = result === 'safe' ? "Successful Compatibility" : "Acute Hemolytic Reaction (Clotting)";
                const prompt = `Act as a hematologist. Write a very brief, formal medical report (max 2 sentences) for a blood transfusion from Donor ${donor} to Recipient ${recipient}. Result: ${status}. Mention antigens/antibodies.`;
                const res = await callGemini(prompt);
                setReport(res);
                setGenerating(false);
            };

            return (
                <div className="pro-card p-6 animate-slide-up">
                    <h3 className="font-bold text-lg text-slate-800 mb-6 flex items-center gap-2"><Heart size={20} className="text-rose-500"/> Transfusion Compatibility</h3>
                    <div className="flex items-center justify-center gap-4 mb-8">
                        <div className="text-center">
                            <div className="w-20 h-24 bg-slate-50 border border-slate-200 rounded-lg flex flex-col items-center justify-center mb-2 shadow-sm"><div className="text-rose-600 font-black text-2xl">{donor}</div><div className="text-[10px] text-slate-400 uppercase font-bold mt-1">Donor</div></div>
                            <select value={donor} onChange={e => {setDonor(e.target.value); setResult(null)}} className="text-xs p-1 bg-white border rounded">{['A','B','AB','O'].map(t => <option key={t} value={t}>Type {t}</option>)}</select>
                        </div>
                        <div className="relative w-24 h-24 rounded-full border-4 border-slate-100 flex items-center justify-center bg-white shadow-inner overflow-hidden">
                            {result === null && <span className="text-slate-300 text-xs">Mix</span>}
                            {result === 'safe' && <div className="w-full h-full bg-rose-500 opacity-80 blur-sm transition-all duration-1000"></div>}
                            {result === 'clot' && <div className="w-16 h-16 bg-rose-900 rounded-full flex items-center justify-center animate-bounce"><X className="text-white"/></div>}
                        </div>
                        <div className="text-center">
                            <div className="w-20 h-24 bg-slate-50 border border-slate-200 rounded-lg flex flex-col items-center justify-center mb-2 shadow-sm"><div className="text-rose-600 font-black text-2xl">{recipient}</div><div className="text-[10px] text-slate-400 uppercase font-bold mt-1">Patient</div></div>
                            <select value={recipient} onChange={e => {setRecipient(e.target.value); setResult(null)}} className="text-xs p-1 bg-white border rounded">{['A','B','AB','O'].map(t => <option key={t} value={t}>Type {t}</option>)}</select>
                        </div>
                    </div>
                    <ModernBtn label="Perform Transfusion" onClick={check} variant="danger" className="w-full" />
                    {result && (
                        <div className="mt-4 space-y-3">
                            <div className={`p-3 rounded-lg text-center text-sm font-bold border ${result === 'safe' ? 'bg-emerald-50 text-emerald-700 border-emerald-100' : 'bg-rose-50 text-rose-700 border-rose-100'}`}>
                                {result === 'safe' ? "‚úÖ Transfusion Successful" : "‚ùå AGGLUTINATION DETECTED"}
                            </div>
                            {!report && <ModernBtn label={generating ? "Generating Report..." : "üìÑ Generate Medical Report (AI)"} onClick={generateReport} variant="secondary" className="w-full" icon={FileText} />}
                            {report && <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 text-xs font-mono text-slate-700 leading-relaxed animate-slide-up"><strong>MEDICAL REPORT:</strong><br/>{report}</div>}
                        </div>
                    )}
                    
                    <DetailBox title="Study Notes: Blood Groups & Rh Factor" isOpen={showDetails} toggle={() => setShowDetails(!showDetails)}>
                        <div className="space-y-4 text-slate-700">
                            <div>
                                <strong className="text-rose-700">ABO System (Karl Landsteiner):</strong>
                                <ul className="list-disc pl-5 mt-1 space-y-1">
                                    <li><strong>Type A:</strong> Antigen A, Antibody b.</li>
                                    <li><strong>Type B:</strong> Antigen B, Antibody a.</li>
                                    <li><strong>Type AB:</strong> Antigens A & B, No antibodies. <em>(Universal Recipient)</em></li>
                                    <li><strong>Type O:</strong> No antigens, Antibodies a & b. <em>(Universal Donor)</em></li>
                                </ul>
                            </div>
                            <div>
                                <strong className="text-rose-700">Erythroblastosis Foetalis:</strong>
                                <p>A condition usually occurring in the second pregnancy of an <strong>Rh-negative mother</strong> carrying an <strong>Rh-positive fetus</strong>. The mother's antibodies attack the fetal blood cells, causing severe anemia or death.</p>
                            </div>
                        </div>
                    </DetailBox>
                </div>
            );
        };

        // --- ZONE 5: PLANTS ---
        const PlantLab = () => {
            const [threat, setThreat] = useState("");
            const [simResult, setSimResult] = useState(null);
            const [loading, setLoading] = useState(false);
            const [showDetails, setShowDetails] = useState(false);

            const runSim = async () => {
                if (!threat) return;
                setLoading(true);
                const prompt = `Simulate a plant's biological defense against: "${threat}". Use scientific terms (Lignin, Cuticle, Toxins, Thorns) but explain simply. Keep it under 2 sentences.`;
                const res = await callGemini(prompt);
                setSimResult(res);
                setLoading(false);
            };

            return (
                <div className="pro-card p-6 animate-slide-up">
                    <h3 className="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2"><Leaf size={20} className="text-emerald-600"/> Plant Survival Simulator</h3>
                    <div className="bg-emerald-50/50 rounded-xl p-6 border border-emerald-100 mb-4 text-center">
                        <div className="text-4xl mb-4">üå±</div>
                        <p className="text-sm text-slate-600 mb-4">I am a plant. What is attacking me?</p>
                        <div className="flex gap-2">
                            <input value={threat} onChange={e => setThreat(e.target.value)} placeholder="e.g. Caterpillar, Drought, Fungus" className="flex-1 px-4 py-3 rounded-xl border border-emerald-200 text-sm focus:outline-none focus:border-emerald-500 shadow-sm" />
                            <ModernBtn label="Attack" onClick={runSim} variant="accent" disabled={loading} />
                        </div>
                    </div>
                    {simResult && <div className="bg-white p-4 rounded-lg border border-slate-100 shadow-sm text-sm text-slate-700 leading-relaxed animate-slide-up"><strong className="text-emerald-700 block mb-1">Defense Activated:</strong>{simResult}</div>}
                    
                    <DetailBox title="Study Notes: Defense in Plants" isOpen={showDetails} toggle={() => setShowDetails(!showDetails)}>
                        <div className="space-y-4 text-slate-700">
                            <div>
                                <strong className="text-emerald-700">1. Structural (Morphological) Defense:</strong>
                                <ul className="list-disc pl-5 mt-1 space-y-1">
                                    <li><strong>Cuticle:</strong> Wax coating preventing water loss and germ entry.</li>
                                    <li><strong>Bark:</strong> Hard, dead outer layer protecting the stem.</li>
                                    <li><strong>Thorns/Spines:</strong> Prevent animals from eating the plant (e.g., Cactus, Rose).</li>
                                    <li><strong>Thick Cell Walls:</strong> Physical barrier against pathogens.</li>
                                </ul>
                            </div>
                            <div>
                                <strong className="text-emerald-700">2. Chemical (Physiological) Defense:</strong>
                                <ul className="list-disc pl-5 mt-1 space-y-1">
                                    <li><strong>Callose:</strong> A polysaccharide that blocks pores (plasmodesmata) to stop germs from spreading between cells.</li>
                                    <li><strong>Lignin / Cutin / Suberin:</strong> Substances that strengthen and harden cell walls.</li>
                                    <li><strong>Antimicrobials:</strong> Chemical poisons produced to kill bacteria or fungi.</li>
                                </ul>
                            </div>
                        </div>
                    </DetailBox>
                </div>
            );
        };

        // --- NEW FEATURE: BATTLE ARENA (GAME) ---
        const BattleArena = () => {
            const [gameState, setGameState] = useState('start'); // start, playing, won, lost
            const [pathogen, setPathogen] = useState(null);
            const [logs, setLogs] = useState([]);
            const [loading, setLoading] = useState(false);
            const [hp, setHp] = useState(100);

            const startBattle = async () => {
                setLoading(true);
                setHp(100);
                setLogs([]);
                // Gemini generates a random pathogen
                const schema = {
                    type: "OBJECT",
                    properties: {
                        name: { type: "STRING" },
                        type: { type: "STRING", enum: ["Virus", "Bacteria", "Fungus"] },
                        description: { type: "STRING" },
                        weakness: { type: "STRING" }
                    }
                };
                const prompt = "Generate a random pathogen (Virus, Bacteria, or Fungus) for an immune system battle game. Give it a creative name.";
                try {
                    const data = await callGeminiJSON(prompt, schema);
                    if (data) {
                        setPathogen(data);
                        setGameState('playing');
                        setLogs([{ text: `‚ö†Ô∏è A wild ${data.name} (${data.type}) has appeared! ${data.description}`, type: 'warning' }]);
                    }
                } catch(e) { console.error(e); }
                setLoading(false);
            };

            const playerMove = async (move) => {
                if (!pathogen || loading) return;
                setLoading(true);
                
                const prompt = `Turn-based battle. Pathogen: ${pathogen.name} (${pathogen.type}, Weakness: ${pathogen.weakness}). User used: "${move}". Calculate damage to pathogen (0-100) and damage to body (0-20). Describe the microscopic battle scene in 1 sentence. Return JSON.`;
                const schema = {
                    type: "OBJECT",
                    properties: {
                        damageToPathogen: { type: "INTEGER" },
                        damageToBody: { type: "INTEGER" },
                        narration: { type: "STRING" },
                        isDefeated: { type: "BOOLEAN" }
                    }
                };

                try {
                    const res = await callGeminiJSON(prompt, schema);
                    if (res) {
                        setLogs(prev => [...prev, { text: `You used ${move}. ${res.narration}`, type: 'move' }]);
                        setHp(h => Math.max(0, h - res.damageToBody));
                        
                        if (res.isDefeated || res.damageToPathogen > 50) { // Simplified win condition
                             setLogs(prev => [...prev, { text: `üéâ Victory! The ${pathogen.name} has been eliminated.`, type: 'success' }]);
                             setGameState('won');
                        } else if (hp - res.damageToBody <= 0) {
                             setLogs(prev => [...prev, { text: `üíÄ System Failure. The infection took over.`, type: 'danger' }]);
                             setGameState('lost');
                        } else {
                             setLogs(prev => [...prev, { text: `The infection fights back! Body Integrity: ${hp - res.damageToBody}%`, type: 'info' }]);
                        }
                    }
                } catch(e) { console.log(e); }
                setLoading(false);
            };

            return (
                <div className="pro-card p-6 animate-slide-up bg-slate-900 text-white border-slate-800">
                    <div className="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                        <h3 className="font-bold text-lg flex items-center gap-2 text-indigo-400">
                            <Swords size={20}/> Immune Battle Arena
                        </h3>
                        <div className="text-xs font-mono bg-slate-800 px-2 py-1 rounded text-slate-400">GEMINI GAME MASTER</div>
                    </div>

                    {gameState === 'start' && (
                        <div className="text-center py-12">
                            <div className="text-6xl mb-4">ü¶†</div>
                            <h2 className="text-xl font-bold mb-2">Defend the Body</h2>
                            <p className="text-slate-400 text-sm mb-6 max-w-xs mx-auto">Use your knowledge of immune cells to defeat randomly generated pathogens powered by AI.</p>
                            <ModernBtn label="Start Simulation ‚ú®" onClick={startBattle} variant="indigo" disabled={loading} className="w-full max-w-xs mx-auto" />
                        </div>
                    )}

                    {gameState === 'playing' && pathogen && (
                        <div className="space-y-4">
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex justify-between items-center">
                                <div>
                                    <div className="text-xs text-rose-400 font-bold uppercase tracking-wider mb-1">Target</div>
                                    <div className="font-bold text-lg">{pathogen.name}</div>
                                    <div className="text-xs text-slate-500">{pathogen.type}</div>
                                </div>
                                <div className="text-right">
                                    <div className="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-1">System Integrity</div>
                                    <div className="font-bold text-lg">{hp}%</div>
                                    <div className="w-24 h-1 bg-slate-700 rounded-full mt-1 ml-auto overflow-hidden"><div className="bg-emerald-500 h-full transition-all duration-500" style={{width: `${hp}%`}}></div></div>
                                </div>
                            </div>

                            <div className="h-48 overflow-y-auto custom-scroll bg-black/20 rounded-xl p-4 space-y-3">
                                {logs.map((log, i) => (
                                    <div key={i} className={`text-sm p-2 rounded border-l-2 ${log.type === 'move' ? 'border-indigo-500 bg-indigo-500/10' : log.type === 'warning' ? 'border-amber-500 bg-amber-500/10' : log.type === 'success' ? 'border-emerald-500 bg-emerald-500/10' : 'border-slate-600'}`}>
                                            {log.text}
                                    </div>
                                ))}
                                {loading && <div className="text-xs text-slate-500 animate-pulse">Calculating outcome...</div>}
                            </div>

                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => playerMove("Macrophage Phagocytosis")} disabled={loading} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-xs font-bold border border-slate-700 transition-colors text-left">üß¨ Deploy Macrophage</button>
                                <button onClick={() => playerMove("Helper T-Cell Signaling")} disabled={loading} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-xs font-bold border border-slate-700 transition-colors text-left">üì° T-Cell Signal</button>
                                <button onClick={() => playerMove("B-Cell Antibodies")} disabled={loading} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-xs font-bold border border-slate-700 transition-colors text-left">üõ°Ô∏è Fire Antibodies</button>
                                <button onClick={() => playerMove("Killer T-Cell Strike")} disabled={loading} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-xs font-bold border border-slate-700 transition-colors text-left">‚öîÔ∏è Killer T-Cell</button>
                            </div>
                        </div>
                    )}

                    {(gameState === 'won' || gameState === 'lost') && (
                        <div className="text-center py-8">
                            <div className="text-4xl mb-4">{gameState === 'won' ? 'üéâ' : 'üíÄ'}</div>
                            <h2 className="text-xl font-bold mb-6">{gameState === 'won' ? 'Infection Cleared!' : 'System Failure'}</h2>
                            <ModernBtn label="Play Again" onClick={startBattle} variant="primary" className="mx-auto" />
                        </div>
                    )}
                </div>
            );
        };

        // --- NEW: AI EXAM PREP (OPTIMIZED) ---
        const AIExamPrep = () => {
            const [mode, setMode] = useState('menu'); // menu, quiz, flashcards, tutor, planner
            const [topic, setTopic] = useState("General Immunity");
            const [qData, setQData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [selected, setSelected] = useState(null);
            const [score, setScore] = useState({ correct: 0, total: 0 });
            const [flashcards, setFlashcards] = useState([]);
            const [flippedCard, setFlippedCard] = useState(null);
            const [tutorChat, setTutorChat] = useState([]);
            const [tutorInput, setTutorInput] = useState("");
            const [daysLeft, setDaysLeft] = useState(7);
            const [studyPlan, setStudyPlan] = useState("");
            const chatEndRef = useRef(null);
            const [quizDifficulty, setQuizDifficulty] = useState("Medium");
            const [mnemonicTopic, setMnemonicTopic] = useState("");
            const [mnemonicRes, setMnemonicRes] = useState(null);

            // Local fallback data for instant generation
            const fallbackData = {
                "General Immunity": { question: "Which enzyme is found in saliva and tears?", options: ["Pepsin", "Lysozyme", "Trypsin", "Amylase"], correctIndex: 1, explanation: "Lysozyme is an enzyme that destroys the cell walls of bacteria." },
                "Skin": { question: "Which protein in the epidermis acts as a barrier?", options: ["Collagen", "Melanin", "Keratin", "Elastin"], correctIndex: 2, explanation: "Keratin makes the skin tough and waterproof." },
                "WBCs": { question: "Which WBC is responsible for antibody production?", options: ["T-Cell", "Neutrophil", "B-Cell", "Basophil"], correctIndex: 2, explanation: "B-Cells produce antibodies." },
                "Blood Groups": { question: "Who is the Universal Donor?", options: ["Type A", "Type B", "Type AB", "Type O"], correctIndex: 3, explanation: "Type O has no antigens and can be given to anyone." },
                "Plants": { question: "What blocks plasmodesmata to stop germ spread?", options: ["Lignin", "Callose", "Cutin", "Suberin"], correctIndex: 1, explanation: "Callose blocks the pores between cells." }
            };

            useEffect(() => {
                if (chatEndRef.current) {
                    chatEndRef.current.scrollIntoView({ behavior: "smooth" });
                }
            }, [tutorChat]);

            const generateQ = async () => {
                setLoading(true);
                setQData(null);
                setSelected(null);
                
                const schema = {
                    type: "OBJECT",
                    properties: {
                        question: { type: "STRING" },
                        options: { type: "ARRAY", items: { type: "STRING" } },
                        correctIndex: { type: "INTEGER" },
                        explanation: { type: "STRING" }
                    }
                };

                const prompt = `Create a unique 10th-grade biology question about '${topic}'.`;

                try {
                    // Timeout after 2 seconds to force fallback if API is slow
                    const apiPromise = callGeminiJSON(prompt, schema);
                    const timeoutPromise = new Promise((resolve) => setTimeout(() => resolve('timeout'), 2000));
                    
                    const res = await Promise.race([apiPromise, timeoutPromise]);
                    
                    if (res && res !== 'timeout') {
                        setQData(res);
                    } else {
                        // Use random fallback for speed
                        setQData(fallbackData[topic] || fallbackData["General Immunity"]);
                    }
                } catch (e) {
                    setQData(fallbackData[topic] || fallbackData["General Immunity"]);
                }
                
                setLoading(false);
            };

            const handleAnswer = (index) => {
                setSelected(index);
                if (index === qData.correctIndex) setScore(s => ({ ...s, correct: s.correct + 1, total: s.total + 1 }));
                else setScore(s => ({ ...s, total: s.total + 1 }));
            };

            const generateFlashcards = async () => {
                setLoading(true);
                setFlashcards([]);
                const schema = {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: { front: { type: "STRING" }, back: { type: "STRING" } }
                    }
                };
                const prompt = `Generate 6 study flashcards for '${topic}' (Immune System). Front: Term/Concept. Back: Simple definition. JSON Array.`;
                try {
                    const res = await callGeminiJSON(prompt, schema);
                    if (res) setFlashcards(res);
                } catch (e) { console.error(e); }
                setLoading(false);
            };

            const startTutor = async () => {
                setMode('tutor');
                setLoading(true);
                setTutorChat([]);
                const intro = "I am Professor Cell. I will ask you oral questions about Immunity. Answer briefly to proceed. Are you ready?";
                setTutorChat([{ role: 'ai', text: intro }]);
                setLoading(false);
            };

            const sendTutorMsg = async () => {
                if (!tutorInput.trim()) return;
                const userMsg = tutorInput;
                setTutorInput("");
                setTutorChat(prev => [...prev, { role: 'user', text: userMsg }]);
                setLoading(true);
                
                const prompt = `Context: Oral Exam on Immune System.
History: ${JSON.stringify(tutorChat.slice(-3))}
User said: "${userMsg}"
Task: Grade the answer (correct/incorrect) and ask a NEW follow-up conceptual question. Be strict but encouraging. Keep it short.`;
                
                const res = await callGemini(prompt);
                setTutorChat(prev => [...prev, { role: 'ai', text: res }]);
                setLoading(false);
            };

            const generatePlan = async () => {
                setLoading(true);
                const prompt = `Create a text-based study plan for SSLC Biology (Immunity) for ${daysLeft} days. Break it down day-by-day. Be motivating.`;
                const res = await callGemini(prompt);
                setStudyPlan(res);
                setLoading(false);
            };

            const generateMnemonic = async () => {
                if (!mnemonicTopic) return;
                setLoading(true);
                const prompt = `Create a short mnemonic for: "${mnemonicTopic}".`;
                const res = await callGemini(prompt);
                setMnemonicRes(res || "Try again.");
                setLoading(false);
            };

            return (
                <div className="pro-card p-6 animate-slide-up bg-gradient-to-br from-white to-slate-50 h-full flex flex-col">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2"><Brain size={20} className="text-indigo-600"/> AI Exam Suite</h3>
                        {mode !== 'menu' && (
                            <button onClick={() => setMode('menu')} className="text-xs bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1">
                                <ArrowLeft size={12}/> Back
                            </button>
                        )}
                    </div>

                    {mode === 'menu' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onClick={() => setMode('quiz')} className="group p-6 rounded-2xl border border-slate-200 hover:border-indigo-500 hover:shadow-lg hover:shadow-indigo-500/10 transition-all text-left bg-white">
                                <div className="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center text-indigo-600 mb-4"><Sparkles size={24}/></div>
                                <div className="font-bold text-slate-800">Adaptive Quiz</div>
                                <div className="text-xs text-slate-500 mt-1">Test your knowledge with AI questions.</div>
                            </button>
                            <button onClick={() => { setMode('flashcards'); generateFlashcards(); }} className="group p-6 rounded-2xl border border-slate-200 hover:border-teal-500 hover:shadow-lg hover:shadow-teal-500/10 transition-all text-left bg-white">
                                <div className="w-12 h-12 bg-teal-100 rounded-xl flex items-center justify-center text-teal-600 mb-4"><Layers size={24}/></div>
                                <div className="font-bold text-slate-800">Smart Flashcards</div>
                                <div className="text-xs text-slate-500 mt-1">Generate study cards instantly.</div>
                            </button>
                            <button onClick={startTutor} className="group p-6 rounded-2xl border border-slate-200 hover:border-rose-500 hover:shadow-lg hover:shadow-rose-500/10 transition-all text-left bg-white">
                                <div className="w-12 h-12 bg-rose-100 rounded-xl flex items-center justify-center text-rose-600 mb-4"><MessageSquare size={24}/></div>
                                <div className="font-bold text-slate-800">Professor AI</div>
                                <div className="text-xs text-slate-500 mt-1">Oral exam simulator.</div>
                            </button>
                            <button onClick={() => setMode('planner')} className="group p-6 rounded-2xl border border-slate-200 hover:border-amber-500 hover:shadow-lg hover:shadow-amber-500/10 transition-all text-left bg-white">
                                <div className="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center text-amber-600 mb-4"><Calendar size={24}/></div>
                                <div className="font-bold text-slate-800">Study Planner</div>
                                <div className="text-xs text-slate-500 mt-1">Create a custom schedule.</div>
                            </button>
                             <button onClick={() => setMode('mnemonic')} className="group p-6 rounded-2xl border border-slate-200 hover:border-purple-500 hover:shadow-lg hover:shadow-purple-500/10 transition-all text-left bg-white">
                                <div className="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-purple-600 mb-4"><Wand size={24}/></div>
                                <div className="font-bold text-slate-800">Mnemonics</div>
                                <div className="text-xs text-slate-500 mt-1">Create memory aids.</div>
                            </button>
                        </div>
                    )}

                    {mode === 'quiz' && (
                        <div className="flex-1 flex flex-col">
                            {!qData ? (
                                <div className="text-center py-8">
                                    <p className="text-sm text-slate-500 mb-4">Select a topic to generate a unique question.</p>
                                    <div className="flex gap-2 justify-center mb-6 flex-wrap">
                                        {['Skin', 'WBCs', 'Blood Groups', 'Plants'].map(t => (
                                            <button key={t} onClick={() => setTopic(t)} className={`px-3 py-1 rounded-full text-xs font-medium border ${topic === t ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-white text-slate-600 border-slate-200'}`}>{t}</button>
                                        ))}
                                    </div>
                                    <ModernBtn label={loading ? "Generating..." : "Generate Question"} onClick={generateQ} variant="primary" className="w-full max-w-xs mx-auto" icon={Sparkles} disabled={loading}/>
                                </div>
                            ) : (
                                <div className="animate-slide-up max-w-2xl mx-auto w-full">
                                    <div className="flex justify-between text-xs font-bold text-slate-400 mb-2">
                                        <span>SCORE: {score.correct}/{score.total}</span>
                                        <span>{quizDifficulty}</span>
                                    </div>
                                    <div className="text-lg font-bold text-slate-800 mb-6">{qData.question}</div>
                                    <div className="space-y-3 mb-6">
                                        {qData.options.map((opt, i) => (
                                            <button key={i} onClick={() => handleAnswer(i)} disabled={selected !== null} className={`w-full text-left p-4 rounded-xl border transition-all ${selected === null ? 'bg-white hover:border-indigo-400' : i === qData.correctIndex ? 'bg-emerald-50 border-emerald-500 text-emerald-800' : i === selected ? 'bg-rose-50 border-rose-500 text-rose-800' : 'opacity-50'}`}>{opt}</button>
                                        ))}
                                    </div>
                                    {selected !== null && (
                                        <div className="bg-indigo-50 p-4 rounded-lg border border-indigo-100 text-sm text-indigo-900 animate-slide-up">
                                            <strong>Explanation:</strong> {qData.explanation}
                                            <div className="mt-3 text-right"><button onClick={generateQ} className="text-xs font-bold text-indigo-700 hover:underline">Next Question &rarr;</button></div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    )}

                    {mode === 'flashcards' && (
                        <div className="flex-1">
                             <div className="flex gap-2 mb-6 justify-center flex-wrap">
                                {['Key Terms', 'Scientists', 'Functions', 'Definitions'].map(t => (
                                    <button key={t} onClick={() => {setTopic(t); generateFlashcards();}} className={`px-3 py-1 rounded-full text-xs font-bold border ${topic === t ? 'bg-teal-600 text-white border-teal-600' : 'bg-white text-slate-600 border-slate-200'}`}>{t}</button>
                                ))}
                            </div>
                            {loading ? <div className="text-center text-teal-600 animate-pulse">Generating Cards...</div> : 
                             flashcards.length > 0 ? (
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    {flashcards.map((card, i) => (
                                        <div key={i} onClick={() => setFlippedCard(flippedCard === i ? null : i)} className="relative h-48 cursor-pointer group perspective-1000">
                                            <div className={`absolute inset-0 w-full h-full transition-all duration-500 preserve-3d shadow-sm hover:shadow-md rounded-xl border border-slate-200 ${flippedCard === i ? 'rotate-y-180' : ''}`}>
                                                <div className="absolute inset-0 backface-hidden bg-white rounded-xl flex items-center justify-center p-4 text-center"><div className="font-bold text-slate-800 text-lg">{card.front}</div></div>
                                                <div className="absolute inset-0 backface-hidden rotate-y-180 bg-teal-50 rounded-xl flex items-center justify-center p-4 text-center border border-teal-100"><div className="text-sm text-teal-900">{card.back}</div></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                             ) : <div className="text-center mt-10 text-slate-400">Select a category.</div>}
                        </div>
                    )}

                    {mode === 'tutor' && (
                        <div className="flex-1 flex flex-col bg-slate-50 rounded-xl border border-slate-200 overflow-hidden">
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 custom-scroll">
                                {tutorChat.map((msg, i) => (
                                    <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${msg.role === 'user' ? 'bg-slate-800 text-white' : 'bg-white border border-slate-200 text-slate-700'}`}>{msg.text}</div>
                                    </div>
                                ))}
                                {loading && <div className="text-xs text-slate-400 ml-4">Typing...</div>}
                                <div ref={chatEndRef} />
                            </div>
                            <div className="p-3 bg-white border-t border-slate-200 flex gap-2">
                                <input value={tutorInput} onChange={e => setTutorInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && sendTutorMsg()} placeholder="Type answer..." className="flex-1 bg-slate-50 px-3 py-2 rounded-lg text-sm outline-none" />
                                <button onClick={sendTutorMsg} className="bg-rose-600 text-white px-4 py-2 rounded-lg text-sm font-bold">Send</button>
                            </div>
                        </div>
                    )}

                    {mode === 'planner' && (
                        <div className="flex-1 flex flex-col items-center justify-center">
                            {!studyPlan ? (
                                <div className="w-full max-w-md bg-white p-6 rounded-xl border border-slate-200 shadow-sm text-center">
                                    <h3 className="font-bold text-slate-800 mb-4">Exam Countdown</h3>
                                    <input type="number" value={daysLeft} onChange={e => setDaysLeft(e.target.value)} className="w-full text-3xl font-bold text-center border-b-2 border-slate-100 py-2 mb-4 outline-none" />
                                    <ModernBtn label="Generate Plan" onClick={generatePlan} variant="amber" className="w-full" disabled={loading} />
                                </div>
                            ) : (
                                <div className="w-full h-full bg-white p-6 rounded-xl border border-slate-200 overflow-y-auto custom-scroll">
                                    <div className="flex justify-between mb-4"><h3 className="font-bold">Your Plan</h3><button onClick={() => setStudyPlan(null)} className="text-xs text-amber-600 font-bold">New</button></div>
                                    <div className="prose prose-sm prose-slate" dangerouslySetInnerHTML={{__html: studyPlan.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br/>')}}></div>
                                </div>
                            )}
                        </div>
                    )}

                    {mode === 'mnemonic' && (
                        <div className="flex-1 flex flex-col items-center justify-center">
                             <div className="bg-indigo-50 p-6 rounded-xl border border-indigo-100 text-center w-full max-w-md">
                                <h4 className="font-bold text-indigo-800 mb-2">Memory Aid Generator</h4>
                                <input value={mnemonicTopic} onChange={e => setMnemonicTopic(e.target.value)} placeholder="Enter terms to remember..." className="w-full p-2 rounded border border-indigo-200 mb-4 text-sm" />
                                <ModernBtn label="Create Mnemonic" onClick={generateMnemonic} variant="indigo" className="w-full" disabled={loading} />
                                {mnemonicRes && <div className="mt-4 bg-white p-4 rounded text-slate-700 text-sm">{mnemonicRes}</div>}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- APP SHELL ---
        const App = () => {
            const [view, setView] = useState('landing');
            const [activeTab, setActiveTab] = useState('external');
            const [menuOpen, setMenuOpen] = useState(false);

            const menuItems = [
                { id: 'external', label: 'External Defense', icon: Shield },
                { id: 'internal', label: 'Internal Defense', icon: Activity },
                { id: 'specific', label: 'Specific Defense', icon: Microscope },
                { id: 'blood', label: 'Blood & Vaccines', icon: Heart },
                { id: 'plants', label: 'Plant Defense', icon: Leaf },
                { id: 'battle', label: 'Battle Mode', icon: Swords },
                { id: 'exam', label: 'AI Exam Prep', icon: Brain },
            ];

            if (view === 'landing') {
                return <LandingPage onEnter={() => setView('app')} />;
            }

            return (
                <div className="min-h-screen flex bg-slate-50">
                    <div className={`fixed inset-0 bg-black/20 z-40 lg:hidden ${menuOpen ? 'block' : 'hidden'}`} onClick={() => setMenuOpen(false)}></div>
                    <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-slate-200 transform transition-transform duration-300 lg:translate-x-0 ${menuOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className="p-6 border-b border-slate-100">
                            <div className="flex items-center gap-2 text-indigo-600 font-bold text-xl">
                                <div className="p-1.5 bg-indigo-600 text-white rounded-lg"><Shield size={20}/></div>
                                BioLab
                            </div>
                            <div className="text-xs text-slate-400 mt-1 font-medium">SSLC IMMUNITY MASTER</div>
                        </div>
                        <nav className="p-4 space-y-1">
                            {menuItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => { setActiveTab(item.id); setMenuOpen(false); }}
                                    className={`w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors ${activeTab === item.id ? 'bg-indigo-50 text-indigo-700' : 'text-slate-600 hover:bg-slate-50'}`}
                                >
                                    <item.icon size={18} />
                                    {item.label}
                                </button>
                            ))}
                        </nav>
                        <div className="absolute bottom-0 w-full p-4 border-t border-slate-100">
                            <div className="bg-slate-900 text-white rounded-lg p-4 text-xs">
                                <div className="font-bold mb-1">Exam Prep Mode</div>
                                <div className="text-slate-400">Progress: 65%</div>
                                <div className="w-full bg-slate-700 h-1 rounded-full mt-2 overflow-hidden"><div className="bg-emerald-400 h-full w-[65%]"></div></div>
                            </div>
                        </div>
                    </aside>

                    <main className="flex-1 lg:ml-64 min-h-screen flex flex-col">
                        <header className="lg:hidden bg-white border-b border-slate-200 p-4 flex items-center justify-between sticky top-0 z-40 shadow-sm">
                            <div className="font-bold text-slate-800">BioLab</div>
                            <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 text-slate-600">{menuOpen ? <X size={24}/> : <Menu size={24}/>}</button>
                        </header>

                        <div className="p-4 md:p-8 max-w-4xl mx-auto w-full h-full flex flex-col">
                            <div className="mb-8 shrink-0">
                                <h1 className="text-2xl md:text-3xl font-bold text-slate-900 mb-2">{menuItems.find(i => i.id === activeTab)?.label}</h1>
                                <p className="text-slate-500 text-sm">Interactive laboratory simulation module.</p>
                            </div>

                            <div className="flex-1">
                                {activeTab === 'external' && <ZoneExternal />}
                                {activeTab === 'internal' && <div className="space-y-6"><PhagocytosisLab /><FeverChart /></div>}
                                {activeTab === 'specific' && <SpecificDefense />}
                                {activeTab === 'blood' && <BloodLab />}
                                {activeTab === 'plants' && <PlantLab />}
                                {activeTab === 'battle' && <BattleArena />}
                                {activeTab === 'exam' && <AIExamPrep />}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
